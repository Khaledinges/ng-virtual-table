{"version":3,"file":"ng-virtual-table.js.map","sources":["ng://ng-virtual-table/src/components/virtual-table.component.ts","ng://ng-virtual-table/src/ngVirtualTable.module.ts"],"sourcesContent":["import { Component, ChangeDetectionStrategy, Input, SimpleChanges } from '@angular/core';\nimport { Observable, EMPTY, Subject, combineLatest, of, BehaviorSubject } from 'rxjs';\nimport {\n  tap,\n  map,\n  startWith,\n  debounceTime,\n  filter,\n  distinctUntilChanged,\n  takeUntil,\n  catchError,\n} from 'rxjs/operators';\nimport { FormControl } from '@angular/forms';\ninterface VirtualTableItem {\n  [key: string]: any;\n}\n\ninterface VirtualTableColumn {\n  name: string;\n  sort: 'asc' | 'desc' | null;\n}\n\n@Component({\n  selector: 'ng-virtual-table',\n  templateUrl: './virtual-table.component.html',\n  styleUrls: ['./virtual-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class VirtualTableComponent {\n  public itemCount = 25;\n\n  @Input() dataSource: Observable<Array<VirtualTableItem>>;\n\n  @Input() headerColumn: Array<string>;\n\n  @Input() onRowClick: (item: VirtualTableItem) => void;\n\n  filterControl: FormControl = new FormControl('');\n\n  private _headerColumn: Set<string> = new Set();\n\n  public column: Array<VirtualTableColumn> = [];\n\n  public _dataStream: Observable<Array<VirtualTableItem>> = EMPTY;\n\n  private sort$: Subject<string> = new Subject<string>();\n\n  private _destroyed$ = new Subject<void>();\n\n  private _headerWasSet = false;\n\n  public empty$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  private filter$ = this.filterControl.valueChanges.pipe(\n    debounceTime(300),\n    startWith(null),\n    distinctUntilChanged(),\n    takeUntil(this._destroyed$),\n  );\n\n  applySort(column: string) {\n    this.column = this.column.map((item) => {\n      if (item.name !== column) {\n        return {\n          ...item,\n          sort: null,\n        };\n      }\n\n      if (item.sort === null) {\n        return {\n          ...item,\n          sort: 'asc',\n        };\n      }\n\n      if (item.sort === 'asc') {\n        return {\n          ...item,\n          sort: 'desc',\n        };\n      }\n\n      if (item.sort === 'desc') {\n        return {\n          ...item,\n          sort: null,\n        };\n      }\n    }) as Array<VirtualTableColumn>;\n    this.sort$.next(column);\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if ('headerColumn' in changes && Array.isArray(changes.headerColumn.currentValue)) {\n      this.column = this.createColumnFromArray(changes.headerColumn.currentValue);\n      this._headerWasSet = true;\n    }\n\n    if ('dataSource' in changes) {\n      const newDataSource = changes.dataSource.currentValue as Observable<Array<VirtualTableItem>>;\n      this._dataStream = combineLatest(\n        this.sort$.asObservable().pipe(startWith(null)),\n        combineLatest(\n          newDataSource.pipe(\n            tap((stream: Array<VirtualTableItem>) => {\n              if (!this._headerWasSet) {\n                this._headerColumn.clear();\n                stream.forEach((e) => Object.keys(e).forEach((key) => this._headerColumn.add(key)));\n                this.column = this.createColumnFromArray(Array.from(this._headerColumn));\n                this._headerWasSet = true;\n              }\n            }),\n            map((stream) => stream.slice()),\n          ),\n          this.filter$,\n        ).pipe(\n          map(([stream, filterString]) => {\n            const sliceStream = stream.slice();\n            if (!filterString) {\n              return sliceStream;\n            }\n            const filter = filterString.toLocaleLowerCase();\n\n            const filterSliceStream = sliceStream.filter((item: VirtualTableItem) =>\n              Object.keys(item).some(\n                (key) => item[key] && item[key].toString().toLocaleLowerCase().indexOf(filter) > -1,\n              ),\n            );\n            return filterSliceStream;\n          }),\n        ),\n      ).pipe(\n        tap(([sort, stream]) => {\n          console.log(stream);\n          if (stream.length > 0) {\n            this.empty$.next(false);\n            return;\n          }\n          this.empty$.next(true);\n        }),\n        map(([sort, stream]) => {\n          const sliceStream = stream.slice();\n\n          const sortColumn = this.column.find((e) => e.name === sort);\n\n          if (!sort || !sortColumn) {\n            return sliceStream;\n          }\n\n          if (!sortColumn.sort) {\n            return sliceStream;\n          }\n\n          if (sortColumn.sort === 'asc') {\n            sliceStream.sort(\n              (a: VirtualTableItem, b: VirtualTableItem) =>\n                a[sortColumn.name] > b[sortColumn.name]\n                  ? 1\n                  : a[sortColumn.name] === b[sortColumn.name] ? 0 : -1,\n            );\n          } else {\n            sliceStream.sort(\n              (a: VirtualTableItem, b: VirtualTableItem) =>\n                a[sortColumn.name] < b[sortColumn.name]\n                  ? 1\n                  : a[sortColumn.name] === b[sortColumn.name] ? 0 : -1,\n            );\n          }\n\n          return sliceStream;\n        }),\n      );\n    }\n  }\n\n  createColumnFromArray(arr: Array<string>): Array<VirtualTableColumn> {\n    return arr.map((e) => ({ name: e, sort: null }));\n  }\n\n  ngOnDestroy() {\n    this._destroyed$.next();\n  }\n\n  clickItem(item: VirtualTableItem) {\n    if (typeof this.onRowClick === 'function') this.onRowClick(item);\n  }\n\n  get isEmptySubject$() {\n    return this.empty$.asObservable();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ScrollDispatchModule } from '@angular/cdk/scrolling';\nimport { VirtualTableComponent } from './components/virtual-table.component';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n@NgModule({\n  declarations: [VirtualTableComponent],\n  imports: [CommonModule, ReactiveFormsModule, BrowserAnimationsModule, ScrollDispatchModule],\n  exports: [VirtualTableComponent],\n  providers: [],\n})\nexport class NgVirtualTableModule {}\n"],"names":[],"mappings":"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"}
